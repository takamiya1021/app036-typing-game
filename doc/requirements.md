# タイピングゲーム - 要件定義書

## プロジェクト概要
制限時間内に文字を正しく入力するタイピング練習ゲーム。AI機能による文章生成と苦手キー分析を搭載。

## 目的・課題
- **目的**: タイピングスキル向上を楽しく継続的に練習できる環境を提供
- **課題**: 単調な練習では継続しにくい、自分の弱点が分からない
- **解決策**: AI による多様な練習文章生成と詳細な分析機能

## ターゲットユーザー
- タイピング初心者から上級者まで
- プログラマー（プログラミング用語の練習）
- タイピング速度向上を目指す全ての人

---

## 機能要件

### 1. タイピング練習機能

#### 1.1 文章タイプ
- **ランダム文字**: 単純な文字列（あいうえお、ABC等）
- **日本語文章**: 日常的な文章、ことわざ、名言等
- **プログラミング用語**: 変数名、関数、コードスニペット等

#### 1.2 難易度設定
- **初級**: 短い文章、基本的な文字のみ
- **中級**: 中程度の文章、記号を含む
- **上級**: 長文、複雑な記号・特殊文字を含む

#### 1.3 ゲームモード
1. **文字数チャレンジモード**
   - 制限時間内（60秒、120秒等）に何文字打てるかを計測
   - リアルタイムで文字数・WPM（Words Per Minute）を表示

2. **文章完成モード**
   - 提示された文章を制限時間内に完成させる
   - 正確性とスピードの両方を評価

### 2. AI機能（必須要件）

#### 2.1 AI文章自動生成
- **機能**: ユーザーの選択した難易度・文章タイプに応じた練習文章を自動生成
- **実装**: OpenAI API または Google Gemini API を使用
- **生成条件**:
  - 初級: 短文（20-40文字）、常用漢字のみ
  - 中級: 中文（40-80文字）、記号を含む
  - 上級: 長文（80-150文字）、複雑な表現・記号を含む
- **バリエーション**: 毎回異なる文章を生成し、練習の飽きを防ぐ

#### 2.2 タイピング上達アドバイス
- **機能**: プレイ後に具体的な改善アドバイスを AI が生成
- **分析項目**:
  - タイピング速度（WPM）
  - 正確性（正誤率）
  - 苦手なキーパターン
- **アドバイス例**:
  - 「左手薬指の動きが遅れています。"A" "S" キーの練習を重点的に行いましょう」
  - 「記号の入力ミスが多いです。Shift キーとの組み合わせを意識してください」

#### 2.3 苦手キー分析
- **機能**: 各キーの入力時間・ミス率を詳細に分析
- **表示内容**:
  - キーボードのビジュアル表示（各キーの正誤率を色分け）
  - 指ごとの統計（どの指が苦手か）
  - 時系列での上達グラフ
- **健康診断的要素**:
  - 特定の指の動きが著しく悪い場合、健康上の注意喚起も可能
  - 例: 「左手薬指のキー入力が一貫して遅いです。指の健康状態を確認してください」

### 3. スコア・統計機能

#### 3.1 リアルタイム表示
- 現在の文字数
- WPM（1分あたりの入力単語数）
- 正確性（%）
- 残り時間

#### 3.2 プレイ履歴
- 過去のスコア一覧
- 上達グラフ（時系列）
- ベストスコア表示

### 4. PWA 対応（必須要件）

#### 4.1 オフライン対応
- **Service Worker**: キャッシュ戦略で完全オフライン動作
- **オフライン機能**:
  - 練習文章のローカルキャッシュ（AI生成文章も一定数保存）
  - スコア記録（IndexedDB）
  - オフライン時の練習継続

#### 4.2 インストール可能
- **Manifest.json**: アプリアイコン、名前、テーマカラー設定
- **インストールプロンプト**: 初回訪問時にインストール促進
- **スタンドアロンモード**: ブラウザUIなしで起動

---

## 技術制約

### 必須技術スタック
- **フロントエンド**: Next.js 14.x / React 18.x
- **スタイリング**: Tailwind CSS v3
- **PWA**: Service Worker、Manifest.json
- **AI API**: OpenAI API または Google Gemini API
- **データ保存**: IndexedDB（ローカルストレージ）

### API要件
- **AI API キー**: 環境変数で管理（`.env.local`）
- **レート制限対策**: キャッシュ戦略、リクエスト制限

---

## 環境要件
- **開発環境**: WSL2 Ubuntu + Windows
- **ブラウザ**: Chrome、Firefox、Safari（最新版）
- **レスポンシブ**: デスクトップ、タブレット、スマートフォン対応

---

## デザイン要求

### UI/UX
- **シンプル**: 練習に集中できるミニマルデザイン
- **視認性**: 大きな文字表示、入力中の文字をハイライト
- **フィードバック**: 正誤を色で即座に表示（正解: 緑、誤り: 赤）

### カラースキーム
- メイン: ブルー系（集中力向上）
- アクセント: グリーン（正解）、レッド（誤り）
- ダークモード対応

### UI参考デザイン
**重要**: 実装時は以下のUIイメージを参考にしてください。

**参考画像**: `png/ui-reference.png`

**デザイン仕様（参考画像に基づく）**:
- **背景**: ダークネイビー（#1e3a8a〜#0f172a）のグラデーション
- **全体レイアウト**: 中央に配置されたカード型UI（角丸、影付き）
- **レイアウト構成**:
  - **左上**: タイトル「タイピングゲーム」（白文字）
  - **右上**: 難易度選択ボタン3つ（丸いアイコンボタン）
    - 練習（緑色）、中級（青色）、上級（赤色）
  - **中央上部**: 統計エリア
    - **WPM**: 大きく強調表示（45等、白文字）
    - **正確性**: 「正確性：92%」（緑色、#10b981）
    - **残り時間**: 「残り時間：01:23」（白文字）
  - **中央メイン**: 練習文章エリア
    - 大きな文字サイズ
    - 文章例：「プログラミングは創造性活動です」
    - 背景：半透明のグレー系カード
  - **下部**: キーボードビジュアル
    - グレー基調（#374151〜#4b5563）
    - キー配列：日本語JISキーボード
    - 各キーは立体的な表現（影付き）
- **キーボードヒートマップ**:
  - **正解キー**: 緑色（#10b981）でハイライト
  - **ミスキー**: 赤色（#ef4444）でハイライト
  - **未入力キー**: グレー（#6b7280）
  - **特殊キー**: Enter、Backspace、Shift等も視覚化
  - **配置**: 実際のキーボード配列を忠実に再現
- **カラーパレット**:
  - 背景：ダークネイビー（#0f172a、#1e3a8a）
  - カード：半透明グレー（rgba(255, 255, 255, 0.05)）
  - メイン文字：白（#ffffff）
  - 正解：緑（#10b981）
  - エラー：赤（#ef4444）
  - アクセント：青（#3b82f6）
- **UI要素の詳細**:
  - カード型デザイン：角丸（rounded-2xl）、影（shadow-2xl）
  - グラスモーフィズム効果：背景ぼかし + 半透明
  - タイポグラフィ：ゴシック系、視認性重視
  - ボタン：丸型アイコンボタン、ホバー時に拡大

**実装時の注意事項**:
- このデザインを**ベース**として、要件に合わせて調整
- レスポンシブ対応時もこのレイアウトを維持
- 日本語フォントは視認性の高いものを選択

---

## 成功基準

### 機能面
- ✅ AI による文章自動生成が正常動作
- ✅ 苦手キー分析が正確
- ✅ オフラインで完全動作

### パフォーマンス
- ✅ キー入力のレスポンス時間 < 50ms
- ✅ AI API レスポンス < 3秒
- ✅ Lighthouse スコア 90点以上

### ユーザビリティ
- ✅ 初回訪問から5分以内に練習開始可能
- ✅ 苦手キー分析レポートが分かりやすい
- ✅ オフラインでも違和感なく使用可能

---

## スケジュール
- **要件定義**: 完了
- **技術設計**: 次フェーズ
- **実装計画**: TDD準拠で作成
- **実装**: フェーズ別に段階実装

---

## 備考
- 既存アプリとの流用: なし（新規タイプ）
- 将来的な拡張: マルチプレイヤー対戦モード、ランキング機能等
